// Script Engine â€” Database Schema
// Module 2: LLM-powered scripts for FUEL and INTELLECTUAL channels

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum ChannelType {
  FUEL
  INTELLECTUAL
}

enum ContentFormat {
  SHORT_FUEL
  DEEP_ESSAY
}

enum Niche {
  FINANCE
  SAAS
  EDUCATION
  HEALTH
  TECH
  MARKETING
  CRYPTO
}

enum ScriptStatus {
  DRAFT
  HOOK_REVIEW
  SCRIPT_REVIEW
  APPROVED
  REJECTED
  IN_PRODUCTION
}

enum HookEmotion {
  CURIOSITY
  FEAR
  SURPRISE
  DESIRE
  URGENCY
}

enum BlockType {
  HOOK
  INTRO
  BODY
  EXAMPLE
  OBJECTION
  CTA
}

enum SpeakerRole {
  HOST
  GUEST
  VOICE_OVER
}

enum VisualSlot {
  AVATAR_STUDIO
  AVATAR_CLOSEUP
  SLIDE
  GRAPH
  BROLL
  SCREEN_DEMO
  TEXT_OVERLAY
}

model Script {
  id            String        @id @default(uuid())
  topicId       String
  channelType   ChannelType
  contentFormat ContentFormat
  niche         Niche
  title         String
  targetMarkets String[]
  languages     String[]      @default(["en"])
  keywords      String[]

  hookVariants   HookVariant[]
  approvedHook   String?
  hookScore      Float?
  hookEmotion    HookEmotion?
  hookApprovedAt DateTime?

  blocks               ScriptBlock[]
  fullScript           String?       @db.Text
  wordCount            Int?
  estimatedDurationSec Int?

  status          ScriptStatus @default(DRAFT)
  reviewNote      String?
  approvedAt      DateTime?
  approvedBy      String?
  rejectedAt      DateTime?
  rejectionReason String?

  llmModel      String?
  llmTokensUsed Int?
  llmCostUsd    Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([channelType])
  @@index([niche])
  @@index([topicId])
  @@index([channelType, status])
}

model HookVariant {
  id               String      @id @default(uuid())
  scriptId         String
  script           Script      @relation(fields: [scriptId], references: [id], onDelete: Cascade)
  text             String
  score            Float
  emotion          HookEmotion
  visualSuggestion String
  audioCue         String?
  reasoning        String?
  isApproved       Boolean     @default(false)
  approvedAt       DateTime?
  createdAt        DateTime    @default(now())

  @@index([scriptId])
  @@index([score])
}

model ScriptBlock {
  id           String      @id @default(uuid())
  scriptId     String
  script       Script      @relation(fields: [scriptId], references: [id], onDelete: Cascade)
  order        Int
  type         BlockType
  startTimeSec Int
  endTimeSec   Int
  content      String      @db.Text
  speakerRole  SpeakerRole @default(VOICE_OVER)
  visualSlot   VisualSlot?
  visualNote   String?
  audioCue     String?
  notes        String?

  @@index([scriptId, order])
}
