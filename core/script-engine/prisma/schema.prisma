// Script Engine — Prisma Schema
// Two formats: SHORT_FUEL (30-90 sec) + DEEP_ESSAY (8-15 min)
// Hook (0-8 sec) is a separate, mandatory approval step

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ============================================================
// ENUMS
// ============================================================

enum ChannelType {
  FUEL          // 30-90 sec, mass traffic
  INTELLECTUAL  // 8-15 min, avatars, Tier-1
}

enum ContentFormat {
  SHORT_FUEL  // hook + 2-3 facts + CTA
  DEEP_ESSAY  // hook + overview + 4 blocks + CTA
}

enum ScriptStatus {
  PENDING          // created, waiting for hook generation
  HOOK_GENERATED   // 5 hook variants ready for human choice
  HOOK_APPROVED    // hook chosen, generating full script
  SCRIPT_GENERATED // full script generated, awaiting review
  UNDER_REVIEW     // submitted for human review
  APPROVED         // human approved, ready for production
  REJECTED         // rejected with notes, can regenerate
}

enum EmotionType {
  CURIOSITY  // "Nobody tells you this..."
  FEAR       // "This mistake costs you $50K..."
  SURPRISE   // "AI just replaced 40% of advisors overnight."
  DESIRE     // "I made $10K in 30 days — here's how."
  URGENCY    // "This window closes in 2026."
}

enum Niche {
  FINANCE    // CPM $15-$50 TOP
  SAAS       // CPM $10-$25
  EDUCATION  // CPM $10-$25
  HEALTH     // CPM $8-$15
  TECH       // CPM $8-$12
  MARKETING  // CPM $6-$10
  CRYPTO     // CPM $5-$12
}

// ============================================================
// MODELS
// ============================================================

model Script {
  id            String        @id @default(uuid())
  topicId       String        @unique  // FK to Topic Engine
  topicTitle    String

  channelType   ChannelType
  contentFormat ContentFormat
  niche         Niche
  targetMarkets String[]
  languages     String[]      @default(["en"])
  keywords      String[]
  description   String?

  // Hook variants (0-8 sec — critical decision window)
  // Research: 55% leave by 60 sec; decision made in first 8 sec
  hookVariants   HookVariant[]
  approvedHookId String?

  // Final scripts
  scriptFuel    String?   // SHORT_FUEL (30-90 sec)
  scriptDeep    String?   // DEEP_ESSAY (8-15 min)

  // Structured production plan with timecodes
  // Each segment: { type, startSec, endSec, text, notes, avatarPlan, slideContent }
  segments      Json?

  // CTA / metadata generated by LLM
  thumbnailIdeas   String[]
  titleVariants    String[]
  commentBait      String[]  // questions to drive +38% comment growth
  localizationNotes String?

  // Status pipeline
  status        ScriptStatus  @default(PENDING)

  // LLM metadata
  llmModel      String?
  llmTokensUsed Int?
  generatedAt   DateTime?

  // Human review
  reviewNotes   String?
  reviewedBy    String?
  reviewedAt    DateTime?
  approvedBy    String?
  approvedAt    DateTime?

  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@index([status])
  @@index([channelType])
  @@index([niche])
  @@index([channelType, status])
}

model HookVariant {
  id               String      @id @default(uuid())
  scriptId         String
  script           Script      @relation(fields: [scriptId], references: [id], onDelete: Cascade)

  // The hook itself (0-8 sec)
  hookText         String
  emotionType      EmotionType

  // Production guidance
  visualSuggestion String      // what to show on screen
  audioSuggestion  String?     // music / sound effect suggestion

  // Quality score from LLM (0-100)
  score            Float?

  // Only one can be approved per script
  approved         Boolean     @default(false)

  createdAt        DateTime    @default(now())

  @@index([scriptId])
  @@index([scriptId, approved])
}
